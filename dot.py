import discord
from discord.ext.commands import Bot
from discord.ext  import commands
from discord.ext.commands.cooldowns import BucketType
import asyncio 
import platform
import colorsys
import requests
import sys
import random
import functools
import praw
import datetime
import json
import traceback 
import aiohttp
import os, re, smtplib
from urllib.request import urlopen, Request
import time
from discord.voice_client import VoiceClient
from discord import Game, Embed, Color, Status, ChannelType



start_time = datetime.datetime.utcnow()

def get_prefix(bot, message):
    """A callable Prefix for our bot. This could be edited to allow per server prefixes."""
    prefixes = ['.']
    return commands.when_mentioned_or(*prefixes)(bot, message)
HOST = '' 
PORT = os.environ["PORT"] 
TOKEN = os.environ["TOKEN"]

try:
    s.bind((HOST,PORT))
except Exception as e:
    print(e)
client = discord.Client()
client = commands.Bot(command_prefix=get_prefix)
client.remove_command('help')
#()  []  {} `
init_extensions = ['cogs.error_handler','cogs.wiki','cogs.fun','cogs.images']

if __name__ == '__main__':
    for extension in init_extensions:
        try:
            client.load_extension(extension)
            print(f'Nacteno {extension}')
        except Exception as e:
            print(f'Nepodarilo se nacist {extension}.', file=sys.stderr)
            traceback.print_exc()
		
def is_owner(ctx):
    return ctx.message.author.id == "417403958814965771"

@client.event
async def on_ready():
    print("The bot is ready!")
    await client.change_presence(game=discord.Game(name='.help | with '+str(len(set(client.get_all_members())))+' users', url="https://twitch.tv/myname", type=1))				
		
		
@client.command(pass_context=True, no_pm=True)
async def info(ctx):	    
    em = discord.Embed(color=discord.Color.purple())
    em.title = 'Informations of Dot'
    em.add_field(name="Poƒçet Server≈Ø", value=len(client.servers))
    em.add_field(name="<:3619_discord_online:544894710511304713> Online Users", value=str(len({m.id for m in client.get_all_members() if m.status is not discord.Status.offline})))
    em.add_field(name='Poƒçet Kan√°l≈Ø', value=f"{sum(1 for g in client.servers for _ in g.channels)}")
    em.add_field(name="Knihovna", value=f"discord.py")
    em.add_field(name="Development of Dot", value=f"<@417403958814965771>")
    em.add_field(name="Pomoc s Dotem", value=f"<@273813194861051907>")
    em.add_field(name="Pozvi Dota, do dal≈°√≠ho pƒõkn√Ωho serveru", value=f"[Zde](https://discordapp.com/oauth2/authorize?client_id={client.user.id}&scope=bot&permissions=268905542)")
    em.add_field(name="M√°≈° nƒõjak√© probl√©my s Dotem?", value=f"[Zde se p≈ôipoj do Support Serveru!](https://discord.gg/Q8sWryN)",inline=False)
    em.add_field(name="Nezapome≈à ho upvotnout!", value=f"[Zde](https://botlist.space/bot/523787927113826305/upvote)",inline=False)
    em.set_footer(text="Dot | Pre-Alpha 1.2")
    await client.say(embed=em)
				
												
@client.command(pass_context=True,no_pm=True)
async def quit(ctx):
    if str(ctx.message.author) != "lepax_#1234":
        await client.say(":x: | **Toto se ti nƒõjak nepovedlo...**") 			
        return
    else:
        await client.say("**üôã Uvid√≠me se brzy!**")
        await client.logout()

		
@client.command(pass_context=True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
@commands.has_permissions(ban_members=True)     
async def unban(ctx, identification:str):
    user = await client.get_user_info(identification)
    await client.unban(ctx.message.server, user)
    try:
        await client.say(f'**:white_check_mark: | {user} byl unbannut!**')
        for channel in ctx.message.server.channels:
          if channel.name == 'log':
              embed=discord.Embed(title="User unbanned!", description="**{0}** unbanned by **{1}**!".format(user, ctx.message.author), color=0x38761D)
              await client.send_message(channel, embed=embed)
    except:
        await client.say(f':x: | Nem≈Ø≈æu unbannout *{user}*')
        pass
  
@client.command(pass_context = True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
@commands.has_permissions(kick_members=True)
async def warn(ctx, userName: discord.User, *, message:str): 
    await client.send_message(userName, "‚ö†Ô∏è Byl si varov√°n kv≈Øli tomuto d≈Øvodu: **{}**".format(message))
    await client.say("**:white_check_mark: | {} Byl varov√°n!** ".format(userName,message))
    pass		
			

						
@client.command(pass_context=True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
@commands.has_permissions(administrator=True)
async def say(ctx, *args):
    argstr = " ".join(args)
    r, g, b = tuple(int(x * 255) for x in colorsys.hsv_to_rgb(random.random(), 1, 1))
    text = argstr
    color = discord.Color((r << 16) + (g << 8) + b)
    await client.send_message(ctx.message.channel, embed=Embed(color = color, description=text))
    await client.delete_message(ctx.message) 

@client.command(pass_context=True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
@commands.has_permissions(ban_members=True)      
async def ban(ctx,user:discord.Member):

    if user.server_permissions.ban_members:
        await client.say('**:negative_squared_cross_mark: | U≈æivatel nebyl zabanov√°n!**')
        return

    try:
        await client.ban(user)
        await client.say('**:white_check_mark: | ' +user.name+ ' byl zabanov√°n!**')

    except discord.Forbidden:

        await client.say('Permission denied.')
        return
    except discord.HTTPException:
        await client.say('ban failed.')
        return
        pass
				
@client.command(pass_context=True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
async def uptime(ctx: commands.Context):
    now = datetime.datetime.utcnow() # Timestamp of when uptime function is run ji
    delta = now - start_time
    hours, remainder = divmod(int(delta.total_seconds()), 3600)
    minutes, seconds = divmod(remainder, 60)
    days, hours = divmod(hours, 24)
    if days:
        time_format = "**{d}** dny, **{h}** hodin, **{m}** minut, and **{s}** sekund."
    else:
        time_format = "**{h}** hodin, **{m}** minut, and **{s}** sekund."
    uptime_stamp = time_format.format(d=days, h=hours, m=minutes, s=seconds)
    await client.say("{} je u≈æ zapl√Ω celkem {}".format(client.user.name, uptime_stamp))
		 

			
@client.command(pass_context = True,no_pm=True)
@commands.cooldown(rate=1, per=10, type=commands.BucketType.user)
@commands.has_permissions(administrator=True)
async def kick(ctx, userName: discord.User):
    await client.kick(userName)
		
@client.command(pass_context = True,no_pm=True)
async def emojiids(ctx):
  for emoji in ctx.message.author.server.emojis:
    print(f"<:{emoji.name}:{emoji.id}>")
    print(" ")    					                 
						

@client.command(pass_context=True,no_pm=True)
async def help(ctx):	
        r, g, b = tuple(int(x * 255) for x in colorsys.hsv_to_rgb(random.random(), 1, 1))
        embed = discord.Embed(title= "", description="", color = discord.Color((r << 16) + (g << 8) + b))
        embed.add_field(name="üìó **Information** [9]", value="`help`, `info`, `ping`, `uptime`, `avatar`, `icon`, `emojis`", inline=False)			
        embed.add_field(name=":o: **User Informations** [3]", value="`serverinfo`, `roleinfo`, `servers`", inline=False)
        embed.add_field(name=":closed_lock_with_key: **Developer Commands** [3]", value="`quit`, `emojiids`, `banall`", inline=False)
        embed.add_field(name=":clap: **Text Commands** [3]", value="`clapify`, `emojify`, `reverse`")
        embed.add_field(name=":printer: **Internet Commands** [4]", value="`wiki`, `google`, `youtube`, `spotify`, `npm`", inline=False)	
        embed.add_field(name="<:FeelsHappyHugMan:542781371157053451> **Fun** [9]", value="`penis`, `howgay`, `meme`, `8ball`, `vtip`, `fakt`, `math`, `achievement`, `slots`", inline=False)			
        embed.add_field(name=":crossed_swords: **Statistic Commamds** [1]", value="`fortnite`", inline=False)
        embed.add_field(name=":thinking: **Mention Commands** [4]", value="`hug`, `kiss`, `slap`, `tickle`", inline=False)
        embed.add_field(name=":cat: **Animals** [3]", value="`dog`, `cat`, `bird`", inline=False)    			
        embed.add_field(name="üîû **NSFW** [11]", value="`ass`, `hentai`, `pussy`, `snapchat`, `4k`, `amateur`, `traps`, `hanal`, `public`, `pgif`, `thigh`", inline=False)	 
        embed.add_field(name="<:emoji_10:555014607056404491> (NSFW) **Private Message** [3]", value="`sendnudes`, `sendtwerk`, `sendhentai`", inline=False)			
        embed.add_field(name=" <:4206_lmaolancer:542781373157736458> **Memes with Fun** [3]", value="`deepfry`, `text`, `isthisa`", inline=False)
        embed.add_field(name="‚öíÔ∏è Supporting [2]", value="`report`, `suggest`", inline=False)
        embed.add_field(name="<:9175_moderation_hammer:542781370687160330> **Moderation** [7]", value="`ban`, `warn`, `say`, `poll`, `purge`, `kick`, `unban`", inline=False)
        embed.add_field(name="üéµ **Music** [9]", value="`play`, `skip`, `stop`, `song`, `queue`, `volume`, `pause`, `mutemusic`, `unmutemusic`", inline=False)
        embed.set_footer(text=f'Requested: {ctx.message.author.display_name} | Prefix [.]', icon_url=f'{ctx.message.author.avatar_url}')
        await client.say(embed=embed)     

        

 		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				
                                        																						     				
@client.command(pass_context=True, no_pm=True)
async def icon(ctx):
    colour = '0x' + 'fce300'
    embed = discord.Embed(title='', description='', color=discord.Color(int(colour, base=16)))
    embed.set_image(url="{}".format(ctx.message.server.icon_url))
    await client.say(embed=embed)
	      
	      		
client.run(TOKEN, client = True)
		                                                                                                
